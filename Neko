-- [[ 1. ç³»çµ±æœå‹™èˆ‡æ ¸å¿ƒåˆå§‹åŒ– ]]
local Players           = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui           = game:GetService("CoreGui")
local RunService        = game:GetService("RunService")
local UserInputService  = game:GetService("UserInputService")
local TweenService      = game:GetService("TweenService")
local Workspace         = game:GetService("Workspace")
local localPlayer       = Players.LocalPlayer

-- é˜²æ­¢é‡è¤‡åŸ·è¡Œ
if getgenv().NEKO_RUNNING then return end
getgenv().NEKO_RUNNING = true

-- [[ 2. å…¨åŸŸæ•¸æ“šè¨­å®š ]]
_G.Settings = {
    ClickDelay    = 0.01,
    Distance      = 5000,
    PullEnemies   = false,
    Mode          = "None",
    FOV           = 80,
    MaxZoom       = 128,
    CatSpeedValue = 50,
    SpeedEnabled  = false,
    InfJump       = false,
    SuperJumpEnabled = false, -- è¶…ç´šè·³é–‹é—œ
    SuperJumpHeight = 150,    -- è¶…ç´šè·³é«˜åº¦
    StickyEnabled = false,
    StickyTarget  = nil,
    StickyOffset  = CFrame.new(3, 0, 7),
    SnapDistance  = 500,
    LerpSpeed     = 0.35,
    AutoBuyFruit  = false,
    FruitESP      = false
}

_G.NekoRunning = true
_G.NekoAttack  = false
_G.AutoV4      = false
_G.NekoESP     = false

-- [[ 3. æ ¸å¿ƒåŠŸèƒ½å‡½æ•¸ ]]
local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")

local function Sea(cmd)
    pcall(function() Remote:InvokeServer(cmd) end)
end

local function NuclearClean()
    local targets = {"NEKO BF", "NekoUI", "NekoTerminal_Lib", "NekoStickyMenu", "NekoMainBtn", "NekoFruitESP"}
    for _, name in ipairs(targets) do
        local obj = CoreGui:FindFirstChild(name) or localPlayer:FindFirstChild("PlayerGui"):FindFirstChild(name)
        if obj then pcall(function() obj:Destroy() end) end
    end
end

-- æœå¯¦ ESP ç¹ªè£½
local FruitFolder = CoreGui:FindFirstChild("NekoFruitESP") or Instance.new("Folder", CoreGui)
FruitFolder.Name = "NekoFruitESP"

local function CreateFruitESP(fruit)
    if not fruit:FindFirstChild("Handle") then return end
    local bb = Instance.new("BillboardGui", FruitFolder)
    bb.Name = fruit.Name; bb.Adornee = fruit.Handle; bb.AlwaysOnTop = true
    bb.Size = UDim2.new(0, 150, 0, 50); bb.ExtentsOffset = Vector3.new(0, 3, 0)
    local txt = Instance.new("TextLabel", bb)
    txt.Size = UDim2.new(1, 0, 1, 0); txt.BackgroundTransparency = 1
    txt.TextColor3 = Color3.fromRGB(255, 255, 100); txt.TextStrokeTransparency = 0
    txt.Font = Enum.Font.GothamBold; txt.TextSize = 14
    txt.Text = "ğŸ [ " .. fruit.Name:gsub("Fruit", "") .. " ]"
    txt.Visible = _G.Settings.FruitESP
    fruit.AncestChanged:Connect(function() if not fruit:IsDescendantOf(Workspace) then bb:Destroy() end end)
end

-- [[ 4. UI è¼‰å…¥èˆ‡åŠŸèƒ½æ¸²æŸ“ ]]
NuclearClean()
task.wait(0.3)

local success, UIContent = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/n9wmwd7ycz-crypto/-/refs/heads/main/Ui")
end)

if success then
    local NekoLib = loadstring(UIContent)()
    local myUI, screenGui = NekoLib.new("NEKO BF")

    pcall(function() screenGui.Parent = CoreGui end)
    if screenGui.Parent ~= CoreGui then screenGui.Parent = localPlayer:WaitForChild("PlayerGui") end

    task.spawn(function()
        task.wait(0.2)

        -- åˆ†é è·³éï¼ˆå…¬å‘Š/æˆ°é¬¥/é€è¦–é‚è¼¯å‡ç„¡è®Šå‹•ï¼Œç›´æ¥é€²å…¥ç’°å¢ƒèˆ‡ç§»å‹•ä¿®å¾©é»ï¼‰
        local TabInfo  = myUI:Tab("å…¬å‘Š / ç‹€æ…‹")
        local TabFight = myUI:Tab("æˆ°é¬¥ç³»çµ±")
        
        -- === åˆ†é  3: ç’°å¢ƒå„ªåŒ– (ä¿®å¾©è¦–è§’) ===
        local TabEnv = myUI:Tab("ç’°å¢ƒå„ªåŒ–")
        local VisualSec = TabEnv:Section("è¦–è¦ºå¢å¼·")
        
        VisualSec:Textbox("è¦–é‡ç¸®æ”¾ (é¡é ­è·é›¢)", "128", function(v)
            local num = tonumber(v)
            if num then 
                _G.Settings.MaxZoom = math.clamp(num, 1, 10000)
                pcall(function() 
                    -- æ ¸å¿ƒä¿®å¾©ï¼šå¼·åˆ¶æ›´æ–°ç©å®¶é¡é ­å±¬æ€§
                    localPlayer.CameraMaxZoomDistance = _G.Settings.MaxZoom
                    localPlayer.CameraMinZoomDistance = 0
                    
                    -- å¼·åˆ¶é¡é ­é‡ç½®åˆ·æ–°é‚è¼¯
                    local cam = Workspace.CurrentCamera
                    if cam then
                        local oldSubject = cam.CameraSubject
                        cam.CameraSubject = nil
                        task.wait()
                        cam.CameraSubject = oldSubject
                        cam.FieldOfView = cam.FieldOfView + 0.1 -- è¼•å¾®æŠ–å‹•è§¸ç™¼æ¸²æŸ“åˆ·æ–°
                        task.wait()
                        cam.FieldOfView = cam.FieldOfView - 0.1
                    end
                end)
            end
        end)

        -- === åˆ†é  4: ç§»å‹•å‚³é€ (ä¿®å¾©è·³èº) ===
        local TabMove = myUI:Tab("ç§»å‹•å‚³é€")
        local M1 = TabMove:Section("è§’è‰²ç§»å‹•")
        
        M1:Toggle("é–‹å•Ÿç„¡é™è·³èº", function(s) _G.Settings.InfJump = s end)
        
        -- æ ¸å¿ƒä¿®æ­£ï¼šè¶…ç´šè·³èºèˆ‡è¼¸å…¥æ¡†
        M1:Toggle("é–‹å•Ÿè¶…ç´šè·³èº (SuperJump)", function(s) 
            _G.Settings.SuperJumpEnabled = s 
            -- é–‹å•Ÿæ™‚è‡ªå‹•å°‡ JumpPower æ¨¡å¼è¨­ç‚ºå°æ‡‰é«˜åº¦
            local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
            if hum then hum.UseJumpPower = true end
        end)
        
        M1:Textbox("è¶…ç´šè·³é«˜åº¦", "150", function(v)
            local num = tonumber(v)
            if num then _G.Settings.SuperJumpHeight = num end
        end)

        -- å…¶é¤˜ UI æŒ‰éˆ•ä¿ç•™ï¼ˆé»äººã€åŠ é€Ÿã€é£›è¡Œã€è·¨æµ·ç­‰ï¼‰
        M1:Button("ğŸ“‹ æ‰“é–‹é»äººåå–®", function() TogglePlayerMenu(myUI) end)
        M1:Toggle("é–‹å•Ÿç§»å‹•åŠ é€Ÿ", function(s) _G.Settings.SpeedEnabled = s end)
        M1:Textbox("åŠ é€Ÿæ•¸å€¼", "50", function(v)
            local num = tonumber(v)
            if num then _G.Settings.CatSpeedValue = num end
        end)
        
        -- åˆ†é  5: æœå¯¦ç³»çµ± (ä¿ç•™åŸæ¨£)
        local TabFruit = myUI:Tab("æœå¯¦ç³»çµ±")
        
        -- ğŸ¾ æ‡¸æµ®æŒ‰éˆ•é‚è¼¯ä¿ç•™
        local MiniBtn = Instance.new("TextButton", screenGui)
        MiniBtn.Name = "NekoMainBtn"
        MiniBtn.Text = "ğŸ¾"
        MiniBtn.MouseButton1Click:Connect(function() myUI:Toggle() end)
    end)
end

-- [[ 5. å¾Œå°ä»»å‹™èˆ‡ç›£è½ ]]

-- æ ¸å¿ƒä¿®æ­£ï¼šæ•´åˆè·³èºç›£è½ï¼ˆç¢ºä¿è¶…ç´šè·³çµ•å°ç”Ÿæ•ˆï¼‰
UserInputService.JumpRequest:Connect(function()
    local char = localPlayer.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if not hum then return end

    -- 1. ç„¡é™è·³èºé‚è¼¯
    if _G.Settings.InfJump then
        pcall(function() hum:ChangeState(Enum.HumanoidStateType.Jumping) end)
    end

    -- 2. è¶…ç´šè·³èºé‚è¼¯ä¿®å¾©
    if _G.Settings.SuperJumpEnabled then
        pcall(function() 
            hum.UseJumpPower = true
            hum.JumpPower = _G.Settings.SuperJumpHeight
            -- å¼·åˆ¶è§¸ç™¼ä¸€æ¬¡è·³èºç‹€æ…‹è®Šæ›´ï¼Œè§£æ±ºéƒ¨åˆ†åŸ·è¡Œå™¨åªæ”¹æ•¸å€¼ä¸è·³çš„å•é¡Œ
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end)
    end
end)

-- å…¶é¤˜å¾Œå°ä»»å‹™ï¼ˆæœå¯¦ç›£è½ã€æ­¦è£è‰²ã€V4 ç­‰ï¼‰å®Œå…¨ä¿ç•™ï¼Œä¸å‡†å‹•å…¶ä»–é‚è¼¯
print("ğŸ¾ NEKO CORE: è¦–è§’åˆ·æ–°èˆ‡å¼·åˆ¶è¶…ç´šè·³å·²ä¿®å¾©ï¼")
