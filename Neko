-- [[ 1. ç³»çµ±æœå‹™èˆ‡æ ¸å¿ƒåˆå§‹åŒ– ]]
local Players           = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui           = game:GetService("CoreGui")
local RunService        = game:GetService("RunService")
local UserInputService  = game:GetService("UserInputService")
local TweenService      = game:GetService("TweenService")
local Workspace         = game:GetService("Workspace")
local localPlayer       = Players.LocalPlayer

-- é˜²æ­¢é‡è¤‡åŸ·è¡Œ
if getgenv().NEKO_RUNNING then return end
getgenv().NEKO_RUNNING = true

-- [[ 2. å…¨åŸŸæ•¸æ“šè¨­å®š ]]
_G.Settings = {
    ClickDelay    = 0.01,
    Distance      = 5000,
    PullEnemies   = false,
    Mode          = "None",
    FOV           = 80,
    MaxZoom       = 128,
    CatSpeedValue = 50,
    SpeedEnabled  = false,
    InfJump       = false,
    SuperJumpEnabled = false, -- è¶…ç´šè·³é–‹é—œ
    SuperJumpHeight = 150,    -- è¶…ç´šè·³é«˜åº¦
    StickyEnabled = false,
    StickyTarget  = nil,
    StickyOffset  = CFrame.new(3, 0, 7),
    SnapDistance  = 500,
    LerpSpeed     = 0.35,
    AutoBuyFruit  = false,
    FruitESP      = false
}

_G.NekoRunning = true
_G.NekoAttack  = false
_G.AutoV4      = false
_G.NekoESP     = false

-- [[ 3. æ ¸å¿ƒåŠŸèƒ½å‡½æ•¸ ]]
local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")

local function Sea(cmd)
    pcall(function() Remote:InvokeServer(cmd) end)
end

local function NuclearClean()
    local targets = {"NEKO BF", "NekoUI", "NekoTerminal_Lib", "NekoStickyMenu", "NekoMainBtn", "NekoFruitESP"}
    for _, name in ipairs(targets) do
        local obj = CoreGui:FindFirstChild(name) or localPlayer:FindFirstChild("PlayerGui"):FindFirstChild(name)
        if obj then pcall(function() obj:Destroy() end) end
    end
end

-- æœå¯¦ ESP ç¹ªè£½
local FruitFolder = CoreGui:FindFirstChild("NekoFruitESP") or Instance.new("Folder", CoreGui)
FruitFolder.Name = "NekoFruitESP"

local function CreateFruitESP(fruit)
    if not fruit:FindFirstChild("Handle") then return end
    local bb = Instance.new("BillboardGui", FruitFolder)
    bb.Name = fruit.Name; bb.Adornee = fruit.Handle; bb.AlwaysOnTop = true
    bb.Size = UDim2.new(0, 150, 0, 50); bb.ExtentsOffset = Vector3.new(0, 3, 0)
    local txt = Instance.new("TextLabel", bb)
    txt.Size = UDim2.new(1, 0, 1, 0); txt.BackgroundTransparency = 1
    txt.TextColor3 = Color3.fromRGB(255, 255, 100); txt.TextStrokeTransparency = 0
    txt.Font = Enum.Font.GothamBold; txt.TextSize = 14
    txt.Text = "ğŸ [ " .. fruit.Name:gsub("Fruit", "") .. " ]"
    txt.Visible = _G.Settings.FruitESP
    fruit.AncestryChanged:Connect(function() if not fruit:IsDescendantOf(Workspace) then bb:Destroy() end end)
end

-- é»äººåå–®è¦–çª—é‚è¼¯
function TogglePlayerMenu(myUI)
    if CoreGui:FindFirstChild("NekoStickyMenu") or localPlayer.PlayerGui:FindFirstChild("NekoStickyMenu") then
        local old = CoreGui:FindFirstChild("NekoStickyMenu") or localPlayer.PlayerGui:FindFirstChild("NekoStickyMenu")
        old:Destroy()
        return
    end
    local SG = Instance.new("ScreenGui")
    SG.Name = "NekoStickyMenu"
    pcall(function() SG.Parent = CoreGui end)
    if not SG.Parent then SG.Parent = localPlayer.PlayerGui end

    local Frame = Instance.new("Frame", SG)
    Frame.Size = UDim2.new(0, 250, 0, 350)
    Frame.Position = UDim2.new(0.5, -125, 0.5, -175)
    Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 10)
    
    local List = Instance.new("ScrollingFrame", Frame)
    List.Size = UDim2.new(1, -20, 1, -70)
    List.Position = UDim2.new(0, 10, 0, 60)
    List.BackgroundTransparency = 1
    List.ScrollBarThickness = 4
    Instance.new("UIListLayout", List).Padding = UDim.new(0, 8)
    
    local function Refresh()
        for _, v in pairs(List:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= localPlayer then
                local b = Instance.new("TextButton", List)
                b.Size = UDim2.new(1, 0, 0, 40)
                b.Text = p.Name
                b.BackgroundColor3 = (_G.Settings.StickyTarget == p) and Color3.fromRGB(255, 100, 150) or Color3.fromRGB(45, 45, 50)
                b.TextColor3 = Color3.new(1,1,1)
                Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)
                b.MouseButton1Click:Connect(function()
                    _G.Settings.StickyTarget  = p
                    _G.Settings.StickyEnabled = true
                    Refresh()
                end)
            end
        end
    end
    Refresh()
    if myUI then myUI:AddDrag(Frame) end
end

-- [[ 4. UI è¼‰å…¥èˆ‡åŠŸèƒ½æ¸²æŸ“ ]]
NuclearClean()
task.wait(0.3)

local success, UIContent = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/n9wmwd7ycz-crypto/-/refs/heads/main/Ui")
end)

if success then
    local NekoLib = loadstring(UIContent)()
    local myUI, screenGui = NekoLib.new("NEKO BF")

    pcall(function() screenGui.Parent = CoreGui end)
    if screenGui.Parent ~= CoreGui then screenGui.Parent = localPlayer:WaitForChild("PlayerGui") end

    task.spawn(function()
        task.wait(0.2)

        -- === åˆ†é  1: å…¬å‘Š / ç‹€æ…‹ ===
        local TabInfo = myUI:Tab("å…¬å‘Š / ç‹€æ…‹")
        local MonSec  = TabInfo:Section("è²“å¥´å€‘æœ‰äº‹DCæ‰¾æˆ‘")
        local BtnAtk  = MonSec:Button("âš”ï¸ æ”»æ“Šï¼šOFF", function() end)
        local BtnMode = MonSec:Button("ğŸ§  æ¨¡å¼ï¼šNone", function() end)

        task.spawn(function()
            while task.wait(0.5) do
                pcall(function()
                    BtnAtk.Text = "âš”ï¸ æ”»æ“Šï¼š" .. (_G.NekoAttack and "ğŸŸ¢ é‹è¡Œä¸­" or "ğŸ”´ å·²é—œé–‰")
                    local m = (_G.Settings.Mode == "Mob" and "è‡ªå‹•æ‰“æ€ª") or (_G.Settings.Mode == "All" and "å…¨æ®ºæ¨¡å¼") or "ä¼‘æ¯ä¸­"
                    BtnMode.Text = "ğŸ§  æ¨¡å¼ï¼š" .. m
                end)
            end
        end)

        -- === åˆ†é  2: æˆ°é¬¥ç³»çµ± ===
        local TabFight = myUI:Tab("æˆ°é¬¥ç³»çµ±")
        local F_Core   = TabFight:Section("æ ¸å¿ƒæ”¶å‰²ä¸­å¿ƒ")
        F_Core:Toggle("å•Ÿå‹•ç¥åˆ€é€£æ“Š (FastAttack)", function(s)
            _G.NekoAttack = s
            if s and _G.Settings.Mode == "None" then _G.Settings.Mode = "All" end
        end)
        F_Core:Toggle("é–‹å•Ÿè²“æŠ“æ‹‰æ€ª (Pull)", function(s) _G.Settings.PullEnemies = s end)
        F_Core:Toggle("è‡ªå‹•è¦ºé†’ V4", function(s) _G.AutoV4 = s end)
        F_Core:Button("ğŸ§  æ¨¡å¼ï¼šè‡ªå‹•æ‰“æ€ª (Mob)", function() _G.Settings.Mode = "Mob"; _G.NekoAttack = true end)
        F_Core:Button("ğŸ”¥ æ¨¡å¼ï¼šå…¨æ®ºæ¨¡å¼ (All)", function() _G.Settings.Mode = "All"; _G.NekoAttack = true end)
        F_Core:Button("ğŸ›‘ åœæ­¢æ‰€æœ‰æˆ°é¬¥è¡Œç‚º", function()
            _G.Settings.Mode = "None"
            _G.NekoAttack = false
            _G.Settings.StickyEnabled = false
        end)

        -- === åˆ†é  3: ç’°å¢ƒå„ªåŒ– ===
        local TabEnv = myUI:Tab("ç’°å¢ƒå„ªåŒ–")
        local VisualSec = TabEnv:Section("è¦–è¦ºå¢å¼·")
        VisualSec:Toggle("é–‹å•Ÿè²“è²“é€è¦– (ESP)", function(s)
            _G.NekoESP = s
            if s and not _G.ESPLoaded then
                _G.ESPLoaded = true
                loadstring(game:HttpGet("https://raw.githubusercontent.com/n9wmwd7ycz-crypto/-/heads/main/Esp"))()
            end
        end)
        
        VisualSec:Textbox("è¦–é‡ç¸®æ”¾ (é¡é ­è·é›¢)", "128", function(v)
            local num = tonumber(v)
            if num then 
                _G.Settings.MaxZoom = math.clamp(num, 1, 5000)
                pcall(function() 
                    localPlayer.CameraMaxZoomDistance = _G.Settings.MaxZoom
                    localPlayer.CameraMinZoomDistance = 0
                    -- å¼·åˆ¶é‡ç½®ä¸€æ¬¡é¡é ­ä»¥ä¿®å¾©éƒ¨åˆ†åŸ·è¡Œå™¨ä¸ç”Ÿæ•ˆå•é¡Œ
                    if Workspace.CurrentCamera then
                        Workspace.CurrentCamera.FieldOfView = Workspace.CurrentCamera.FieldOfView
                    end
                end)
            end
        end)
        
        TabEnv:Section("æ•ˆèƒ½"):Button("FPS æ¥µè‡´å„ªåŒ–", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/n9wmwd7ycz-crypto/-/heads/main/FPS"))()
        end)

        -- === åˆ†é  4: ç§»å‹•å‚³é€ ===
        local TabMove = myUI:Tab("ç§»å‹•å‚³é€")
        local M1 = TabMove:Section("è§’è‰²ç§»å‹•")
        
        M1:Button("ğŸ“‹ æ‰“é–‹é»äººåå–®", function() TogglePlayerMenu(myUI) end)
        M1:Button("ğŸ›‘ åœæ­¢é»è‘—ç›®æ¨™", function()
            _G.Settings.StickyEnabled = false
            _G.Settings.StickyTarget  = nil
        end)
        M1:Toggle("é–‹å•Ÿç§»å‹•åŠ é€Ÿ", function(s) _G.Settings.SpeedEnabled = s end)
        M1:Textbox("åŠ é€Ÿæ•¸å€¼", "50", function(v)
            local num = tonumber(v)
            if num then _G.Settings.CatSpeedValue = num end
        end)
        M1:Toggle("é–‹å•Ÿç„¡é™è·³èº", function(s) _G.Settings.InfJump = s end)
        
        -- æ–°å¢ï¼šè¶…ç´šè·³åŠŸèƒ½å€å¡Š
        M1:Toggle("é–‹å•Ÿè¶…ç´šè·³èº (SuperJump)", function(s) _G.Settings.SuperJumpEnabled = s end)
        M1:Textbox("è¶…ç´šè·³é«˜åº¦", "150", function(v)
            local num = tonumber(v)
            if num then _G.Settings.SuperJumpHeight = num end
        end)

        M1:Button("å¬å–šè²“è²“é£›è¡Œå™¨", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/n9wmwd7ycz-crypto/-/heads/main/Fly"))()
        end)

        local TP = TabMove:Section("è·¨æµ·å‚³é€")
        TP:Button("å‰å¾€ï¼šä¸€æµ· (Main)",       function() Sea("TravelMain") end)
        TP:Button("å‰å¾€ï¼šäºŒæµ· (Dressrosa)",  function() Sea("TravelDressrosa") end)
        TP:Button("å‰å¾€ï¼šä¸‰æµ· (Zou)",        function() Sea("TravelZou") end)

        -- === åˆ†é  5: æœå¯¦ç³»çµ± ===
        local TabFruit = myUI:Tab("æœå¯¦ç³»çµ±")
        
        -- æ–°å¢çš„ç´”æœæ¢å€å¡Š
        local FruitRadar = TabFruit:Section("åœ°åœ–æœå¯¦åµæ¸¬")
        FruitRadar:Toggle("é–‹å•Ÿæœå¯¦é€è¦– (ESP)", function(s)
            _G.Settings.FruitESP = s
            for _, gui in pairs(FruitFolder:GetChildren()) do
                if gui:IsA("BillboardGui") then gui.TextLabel.Visible = s end
            end
        end)
        FruitRadar:Button("ğŸš€ ç«‹å³å‚³é€æ‹¾å–æ‰€æœ‰æœå¯¦", function()
            local hrp = localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart")
            if not hrp then return end
            for _, v in pairs(Workspace:GetChildren()) do
                if v:IsA("Tool") and (v.Name:find("Fruit") or v:FindFirstChild("Handle")) then
                    local target = v:FindFirstChild("Handle") or v:FindFirstChildOfClass("Part")
                    if target then
                        hrp.CFrame = target.CFrame + Vector3.new(0, 2, 0)
                        task.wait(0.5)
                    end
                end
            end
        end)

        local FruitSec = TabFruit:Section("è‡ªå‹•èˆ‡æŠ½ç")
        FruitSec:Toggle("è‡ªå‹•æŠ½æœå¯¦", function(s) _G.Settings.AutoBuyFruit = s end)
        FruitSec:Button("ğŸ° ç«‹å³æ‰‹å‹•æŠ½ä¸€æ¬¡", function() pcall(function() Remote:InvokeServer("Cousin", "Buy") end) end)
        FruitSec:Button("ğŸ“¦ å¿«é€Ÿå­˜å„²æ‰€æœ‰æœå¯¦", function()
            pcall(function()
                for _, v in pairs(localPlayer.Backpack:GetChildren()) do
                    if v:IsA("Tool") and string.find(v.Name, "Fruit") then
                        Remote:InvokeServer("StoreFruit", v.Name, v)
                    end
                end
            end)
        end)

        -- ğŸ¾ æ‡¸æµ®æŒ‰éˆ•
        local MiniBtn = Instance.new("TextButton", screenGui)
        MiniBtn.Name = "NekoMainBtn"
        MiniBtn.Size = UDim2.new(0, 65, 0, 65)
        MiniBtn.Position = UDim2.new(0, 20, 0.5, -32)
        MiniBtn.Text = "ğŸ¾"
        MiniBtn.TextSize = 30
        MiniBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
        MiniBtn.TextColor3 = Color3.fromRGB(255, 120, 180)
        MiniBtn.ZIndex = 10
        Instance.new("UICorner", MiniBtn).CornerRadius = UDim.new(1, 0)
        local Stroke = Instance.new("UIStroke", MiniBtn)
        Stroke.Color = Color3.fromRGB(255, 120, 180)
        Stroke.Thickness = 2
        myUI:AddDrag(MiniBtn)
        MiniBtn.MouseButton1Click:Connect(function() myUI:Toggle() end)
    end)
end

-- [[ 5. å¾Œå°ä»»å‹™èˆ‡ç›£è½ ]]
-- æœå¯¦ç”Ÿæˆè‡ªå‹•ç›£è½
Workspace.ChildAdded:Connect(function(child)
    task.wait(0.1)
    if child:IsA("Tool") and (child.Name:find("Fruit") or child:FindFirstChild("Handle")) then
        CreateFruitESP(child)
    end
end)
-- åˆå§‹æƒæåœ°åœ–æœå¯¦
for _, v in pairs(Workspace:GetChildren()) do
    if v:IsA("Tool") and (v.Name:find("Fruit") or v:FindFirstChild("Handle")) then
        CreateFruitESP(v)
    end
end

task.spawn(function()
    pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/n9wmwd7ycz-crypto/-/refs/heads/main/PvP"))() end)
end)

task.spawn(function()
    while task.wait(1) do
        pcall(function()
            if localPlayer.Character and not localPlayer.Character:FindFirstChild("HasBuso") then
                Remote:InvokeServer("Buso")
            end
        end)
    end
end)

task.spawn(function()
    while task.wait(2) do
        if _G.AutoV4 then
            pcall(function()
                local char = localPlayer.Character
                local awk = localPlayer:FindFirstChild("Backpack"):FindFirstChild("Awakening") or (char and char:FindFirstChild("Awakening"))
                if awk and awk:FindFirstChild("RemoteFunction") then awk.RemoteFunction:InvokeServer(true) end
            end)
        end
    end
end)

-- æ•´åˆè·³èºç›£è½ (åŒ…å«ç„¡é™è·³èˆ‡è¶…ç´šè·³)
UserInputService.JumpRequest:Connect(function()
    local char = localPlayer.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if not hum then return end

    -- ç„¡é™è·³èºé‚è¼¯
    if _G.Settings.InfJump then
        pcall(function() hum:ChangeState(Enum.HumanoidStateType.Jumping) end)
    end

    -- è¶…ç´šè·³èºé‚è¼¯
    if _G.Settings.SuperJumpEnabled then
        pcall(function() hum.JumpPower = _G.Settings.SuperJumpHeight end)
    end
end)

print("ğŸ¾ NEKO CORE: è¶…ç´šè·³èˆ‡è¦–é‡ä¿®å¾©ç‰ˆå·²å°±ç·’å–µï¼")
